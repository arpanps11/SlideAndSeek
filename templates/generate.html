<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Generate Worship Slides</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f2f2f2;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .section-selector, .section-container {
            max-width: 800px;
            margin: 20px auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        select, input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 12px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        button {
            padding: 10px 16px;
            margin-top: 10px;
            margin-right: 8px;
            background-color: #0077cc;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #005fa3;
        }
        .song-list, .section-box {
            margin-top: 10px;
        }
        .song-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }
        .section-box {
            border: 1px solid #ddd;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .section-controls {
            text-align: right;
        }
        .checkbox-label {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .checkbox-label input[type="checkbox"] {
            margin-right: 8px;
        }
        .home-button {
            display: block;
            text-align: center;
            margin: 30px auto 0;
        }
        .home-button a {
            text-decoration: none;
            padding: 10px 20px;
            background-color: #333;
            color: white;
            border-radius: 5px;
        }
        .home-button a:hover {
            background-color: #111;
        }
    </style>
</head>
<body>
    <h1>Generate Worship Slides</h1>

    <form method="POST">
        <div class="section-selector">
            <label>Select Sections to Include (check to add):</label>
            <div class="checkbox-label"><input type="checkbox" id="welcome_section"> Welcome Slide</div>
            <div class="checkbox-label"><input type="checkbox" id="praise_section"> Praise and Worship</div>
            <div class="checkbox-label"><input type="checkbox" id="opening_section"> Opening Hymn</div>
            <div class="checkbox-label"><input type="checkbox" id="offertory_section"> Offertory Hymn</div>
            <div class="checkbox-label"><input type="checkbox" id="communion_section"> Communion Hymn</div>
            <div class="checkbox-label"><input type="checkbox" id="rr_section"> Responsive Reading</div>
            <div class="checkbox-label"><input type="checkbox" id="extras_section"> Extras</div>
            <div class="checkbox-label"><input type="checkbox" id="benediction_section"> Benediction</div>
        </div>

        <div id="sections" class="section-container"></div>

        <div style="text-align:center;">
            <button type="submit">Generate PowerPoint</button>
        </div>
    </form>

    <div class="home-button">
        <a href="/">← Back to Home</a>
    </div>

    <script>
        const sectionsContainer = document.getElementById('sections');
        const sectionsMap = {
            'welcome_section': 'Welcome Slide',
            'praise_section': 'Praise and Worship',
            'opening_section': 'Opening Hymn',
            'offertory_section': 'Offertory Hymn',
            'communion_section': 'Communion Hymn',
            'rr_section': 'Responsive Reading',
            'extras_section': 'Extras',
            'benediction_section': 'Benediction'
        };

        const songOptions = `{{ songs|tojson|safe }}`;
        const rrOptions = `{{ rrs|tojson|safe }}`;
        const songs = JSON.parse(songOptions);
        const rrs = JSON.parse(rrOptions);

        function createSongDropdown(name, multiple=false) {
            const select = document.createElement('select');
            select.name = name;
            if (multiple) select.multiple = true;
            songs.forEach(song => {
                const option = document.createElement('option');
                option.value = song.id;
                option.textContent = song.title;
                select.appendChild(option);
            });
            return select;
        }

        function createRRDropdown() {
            const select = document.createElement('select');
            select.name = 'rr_id';
            rrs.forEach(rr => {
                const option = document.createElement('option');
                option.value = rr.id;
                option.textContent = `Responsive Reading ${rr.rr_number} - Psalm ${rr.psalm_number}`;
                select.appendChild(option);
            });
            return select;
        }

        function createSectionBox(id) {
            const box = document.createElement('div');
            box.className = 'section-box';
            box.dataset.sectionId = id;

            const title = document.createElement('h3');
            title.textContent = sectionsMap[id];
            box.appendChild(title);

            if (id === 'welcome_section') {
                const input = document.createElement('input');
                input.type = 'text';
                input.name = 'welcome_text';
                input.placeholder = 'Welcome to the Worship Service';
                box.appendChild(input);
            }

            else if (id === 'praise_section') {
                const select = createSongDropdown('praise_ids[]', true);
                box.appendChild(select);
            }

            else if (['opening_section', 'offertory_section', 'communion_section'].includes(id)) {
                const select = createSongDropdown(id.replace('_section', '_id'));
                box.appendChild(select);
            }

            else if (id === 'rr_section') {
                const select = createRRDropdown();
                box.appendChild(select);
            }

            else if (id === 'extras_section') {
                const titleInput = document.createElement('input');
                titleInput.type = 'text';
                titleInput.name = 'extras_title';
                titleInput.placeholder = 'Enter Extras Section Title';
                box.appendChild(titleInput);

                const select = createSongDropdown('extras_ids[]', true);
                box.appendChild(select);
            }

            else if (id === 'benediction_section') {
                const p = document.createElement('p');
                p.textContent = 'This section will include two fixed Benediction slides.';
                box.appendChild(p);
            }

            const controls = document.createElement('div');
            controls.className = 'section-controls';

            const up = document.createElement('button');
            up.type = 'button';
            up.textContent = '↑';
            up.onclick = () => {
                const prev = box.previousElementSibling;
                if (prev) sectionsContainer.insertBefore(box, prev);
            };

            const down = document.createElement('button');
            down.type = 'button';
            down.textContent = '↓';
            down.onclick = () => {
                const next = box.nextElementSibling;
                if (next) sectionsContainer.insertBefore(next, box);
            };

            const hidden = document.createElement('input');
            hidden.type = 'hidden';
            hidden.name = 'section_order[]';
            hidden.value = id;

            controls.appendChild(up);
            controls.appendChild(down);
            box.appendChild(hidden);
            box.appendChild(controls);

            return box;
        }

        Object.keys(sectionsMap).forEach(id => {
            document.getElementById(id).addEventListener('change', function() {
                if (this.checked) {
                    const sectionBox = createSectionBox(id);
                    sectionsContainer.appendChild(sectionBox);
                } else {
                    const toRemove = [...sectionsContainer.children].find(div => div.dataset.sectionId === id);
                    if (toRemove) sectionsContainer.removeChild(toRemove);
                }
            });
        });
    </script>
</body>
</html>
